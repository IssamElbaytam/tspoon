<p>var es = require(&quot;event-stream&quot;);
var gutil = require(&quot;gulp-util&quot;);
var PluginError = gutil.PluginError;
var typedocModule = require(&quot;typedoc&quot;);
var _ = require(&#39;lodash&#39;);</p>
<p>function typedoc(options) {
    var files = [];
    options = options || {};
    options.theme = &#39;./doc/js/typedoc-themes/custom&#39;;
    options.module = &#39;commonjs&#39;;
    options.target = &quot;es5&quot;;
    options.includeDeclarations = false;
    options.ignoreCompilerErrors = false;
    options.version = true;</p>
<pre><code>return es.through(function(file) {
    files.push(file.path);
}, function() {
    // end of stream, start typedoc
    var stream = this;

    if (files.length === 0) {
        stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;No input files for TypeDoc.&quot;));
        stream.emit(&quot;end&quot;);
        return;
    } else if (!options.out) {
        stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;You must either specify the &#39;out&#39; option.&quot;));
        stream.emit(&quot;end&quot;);
        return;
    } else {
        // leaving the &#39;out&#39; or &#39;version&#39; option in causes typedoc error for some reason
        var out = options.out;
        delete options.out;
        var json = options.json;
        delete options.json;
        var version = options.version;
        delete options.version;

        // reduce console logging
        options.logger = function(message, level, newline) {
            if (level === 3) {
                gutil.log(gutil.colors.red(message));
            }
        }

        // typedoc instance
        var app = new typedocModule.Application(options);

        if (version) {
            gutil.log(app.toString());
        }
        var src = app.expandInputFiles(files);
        var project = app.convert(src);
        if (project) {
            var index = _.find(project.children, function(child) {
                return child.name == &#39;&quot;index&quot;&#39;;
            });
            index.name = options.name || &#39;index&#39;;
            index.children = [];
            project.children.forEach(function(child) {
                index.children = index.children.concat(child.children);
            });
            index.children = index.children.sort(function(a, b) {
               return a.kind == b.kind ? 0 : a.kind &lt; b.kind ? 1 : -1;
            });
            project.children = [ index ];
            if (out) app.generateDocs(project, out);
            if (app.logger.hasErrors()) {
                stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;There were errors generating TypeDoc output, see above.&quot;));
                stream.emit(&quot;end&quot;);
                return;
            }
        } else {
            stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;Failed to generate load TypeDoc project.&quot;));
            stream.emit(&quot;end&quot;);
            return;
        }
        stream.emit(&quot;end&quot;);
        return;
    }
});
</code></pre><p>};</p>
<p>module.exports = typedoc;</p>
