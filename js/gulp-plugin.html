<p>var gulp = require(&#39;gulp&#39;);
var ghPages = require(&#39;gulp-gh-pages&#39;);
var markdown = require(&#39;gulp-markdown&#39;);
var es = require(&quot;event-stream&quot;);
var gutil = require(&quot;gulp-util&quot;);
var PluginError = gutil.PluginError;
var typedocModule = require(&quot;typedoc&quot;);
var _ = require(&#39;lodash&#39;);</p>
<p>function typedoc(options) {
    var files = [];
    options = options || {};</p>
<pre><code>return es.through(function(file) {
    files.push(file.path);
}, function() {
    // end of stream, start typedoc
    var stream = this;

    if (files.length === 0) {
        stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;No input files for TypeDoc.&quot;));
        stream.emit(&quot;end&quot;);
        return;
    } else if (!options.out &amp;&amp; !options.json) {
        stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;You must either specify the &#39;out&#39; or &#39;json&#39; option.&quot;));
        stream.emit(&quot;end&quot;);
        return;
    } else {
        // leaving the &#39;out&#39; or &#39;version&#39; option in causes typedoc error for some reason
        var out = options.out;
        delete options.out;
        var json = options.json;
        delete options.json;
        var version = options.version;
        delete options.version;

        // reduce console logging
        options.logger = function(message, level, newline) {
            if (level === 3) {
                gutil.log(gutil.colors.red(message));
            }
        }

        // typedoc instance
        var app = new typedocModule.Application(options);

        if (version) {
            gutil.log(app.toString());
        }
        var src = app.expandInputFiles(files);
        var project = app.convert(src);
        debugger;
        var index = _.find(project.children, function(child) { return child.name == &#39;&quot;index&quot;&#39;; } );
        index.children = [];
        index.name = &#39;tspoon&#39;;
        project.children.forEach(function(child) {
            index.children = index.children.concat(child.children);
        } );
        project.children = [ index ];
        index.children = index.children.sort(function(a, b) {
            return a.kind == b.kind ? 0 : a.kind &gt; b.kind ? 1 : -1;
        });
        if (project) {
            if (out) app.generateDocs(project, out);
            if (json) app.generateJson(project, json);
            if (app.logger.hasErrors()) {
                stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;There were errors generating TypeDoc output, see above.&quot;));
                stream.emit(&quot;end&quot;);
                return;
            }
        } else {
            stream.emit(&quot;error&quot;, new PluginError(PLUGIN_NAME, &quot;Failed to generate load TypeDoc project.&quot;));
            stream.emit(&quot;end&quot;);
            return;
        }
        stream.emit(&quot;end&quot;);
        return;
    }
});
</code></pre><p>};</p>
<p>module.exports = typedoc;</p>
